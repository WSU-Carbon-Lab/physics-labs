# Fluke PM5139 Programming Context via NI-VISA & Python

## 1. Communication Interface Setup

The PM5139 can be controlled via an IEEE-488 (GPIB) interface (Option /02) or an RS-232 interface (Option /03).

### VISA Resource Strings

* **GPIB:** `GPIB0::<Address>::INSTR`
* The device address (1–30) is selected using the front panel **ADDR** key and rotary knob.




* **RS-232:** `ASRL<Port>::INSTR` (e.g., `ASRL1::INSTR` for COM1).

### RS-232 Configuration (Option /03)

To communicate via RS-232, the instrument configuration must match the controller. Press the **ADDR** key to view/change settings.

*
**Connector:** 9-pin D-connector (male).


*
**Baud Rates:** 110, 150, 300, 600, 1200, 2400, 4800, 9600, 19200.


*
**Data Bits:** 7 or 8.


*
**Parity:** Odd, Even, or None (None is only for 8 data bits).


*
**Handshake:** Xon/Xoff (Software) or DSR/DTR & CTS/RTS (Hardware).


*
**RS-232 Specific Commands:** The RS-232 interface uses `ESC` sequences to mimic IEEE-488 interface functions:


* `ESC 1`: Go to Local (GTL).
* `ESC 2`: Go to Remote (GTR).
* `ESC 4`: Device Clear (DCL).
* `ESC 7`: Ask for Status Byte (*STB?).
* `ESC 8`: Device Trigger (DTR).



### Python (PyVISA) Connection Skeleton

```python
import pyvisa as visa

rm = visa.ResourceManager()

# Example for GPIB (Address 20)
# device = rm.open_resource('GPIB0::20::INSTR')

# Example for RS-232 (COM1, 9600 Baud)
device = rm.open_resource('ASRL1::INSTR')
device.baud_rate = 9600
device.data_bits = 8
device.parity = visa.constants.Parity.none
device.stop_bits = visa.constants.StopBits.one
# RS-232 termination usually requires just NL
device.write_termination = '\n'
device.read_termination = '\n'

# Enter remote mode (RS-232 only)
device.write('\x1B2') # Sends ESC 2

# Reset and clear status
device.write('*RST;*CLS')

# Query ID
print(device.query('*IDN?'))

device.close()

```

---

## 2. Command Syntax & Notation

*
**Separators:** Multiple commands in a message are separated by a semicolon `;`.


*
**Header/Data:** A space must separate the command header and the data element.


* **Terminators:**
*
**IEEE-488:** Accepts `NL` (New Line), `^END` (EOI), or both.


*
**RS-232:** Accepts `NL`.




* **Numeric format:** Flexible numeric representation (`NRf`) is accepted. The instrument automatically assigns dimensions (Hz, V, s, %, DEG).


*
**Abbreviations:** Allowed abbreviations are shown in bold in the manual (e.g., `FREQuency` -> `FREQ`).



---

## 3. Common Commands (IEEE-488.2)

| Command | Description | Return Format |
| --- | --- | --- |
| `*IDN?` | Identification Query. | <br>`FLUKE, PM5139,0,Vx.x/0000`.

 |
| `*RST` | Reset. Sets instrument to defined status (1kHz, Sine, 1.1V, Modulation OFF).

 | None |
| `*TST?` | Self-test Query. Checks memories. | <br>`0` (No error), `1`, `2`, or `4` (Errors).

 |
| `*OPC` | Operation Complete. Sets bit 0 of Event Status Register when function finished.

 | None |
| `*OPC?` | Operation Complete Query. Returns 1 when function finished.

 | `1` |
| `*WAI` | Wait-to-Continue. Executes next command only when previous is complete.

 | None |
| `*TRG` | Trigger Command. Starts burst or sweep.

 | None |
| `*SAV <1-9>` | Save current settings to register 1-9.

 | None |
| `*RCL <1-9>` | Recall settings from register 1-9.

 | None |
| `*LRN?` | Learn Mode Query. Returns complete instrument setup string.

 | String of commands (e.g., `MODOFF; FREQ...`).

 |

---

## 4. Signal Output Commands

### Waveform Selection (`WAVEFORM`)

*
**Query:** `WAVEFORM?`.


*
**Commands:**


* `SINE` (Sine)
* `TRNGLE` (Triangle)
* `SQUARE` / `SQR` (Square)
* `POSPULSE` (Positive Pulse)
* `NEGPULSE` (Negative Pulse)
* `POSSAWTOOTH` / `SAWTOOTH` (Positive Sawtooth)
* `NEGSAWTOOTH` (Negative Sawtooth)
* `HAVERSINE` (Haversine)
* `ARB` (Arbitrary)



### Frequency (`FREQ`)

*
**Command:** `FREQ <value>`.


* **Query:** `FREQ?`.
*
**Range:** 0.1 mHz to 20 MHz (waveform dependent).


*
**Example:** `FREQ 10E6` (Sets 10 MHz).



### Amplitude and Offset

* **AC Amplitude:**
* Command: `AMPLTUDE <value>`.


* State: `AC ON` / `AC OFF` (or `ACON` / `ACOFF`).


* Range: 0 - 20 Vpp (open circuit).




* **DC Offset:**
* Command: `DCOFFSET <value>`.


* State: `DC ON` / `DC OFF` (or `DCON` / `DCOFF`).


* Range: -10 V to +10 V.


* Constraint: AC peak + DC offset must not exceed ±10 V.




*
**Impedance:** `LOWIMP ON` (Low Z) or `LOWIMP OFF` (50 Ω).



### Symmetry (`DUTYCYCLE`)

*
**Command:** `DUTYCYCLE <value>` (Sets asymmetry %).


*
**State:** `SYMMETRY ON` (Sets duty cycle to 50%) / `SYMMETRY OFF`.



---

## 5. Modulation, Sweep, and Burst

### Modulation Setup

*
**Mode Selection:** `MODLN <type>` or simply `<type>`.


* Types: `AM`, `FM`, `PSK`, `GATE`, `BURST`, `OFF` (or `MODOFF`).




*
**Source:** `MODSRC INT` (Internal) or `MODSRC EXT` (External).


*
**Internal Frequency:** `MODFREQ <value>` (10 Hz - 100 kHz).



| Mode | Parameter Command | Description |
| --- | --- | --- |
| **AM** | `AMDEPTH <value>` | Depth in % (0-100).

 |
| **FM** | `FMDEVIATION <value>` | Deviation in % (0-2).

 |
| **Sweep** | `SWEEP <LIN/LOG>` | Select Linear or Logarithmic sweep.

 |
|  | `STARTFREQ <value>` | Start Frequency.

 |
|  | `STOPFREQ <value>` | Stop Frequency.

 |
|  | `SWEEPTIME <value>` | Time in seconds (0.01 - 1000).

 |
|  | `SWEEPMODE <1/2/3>` | Mode 1 (Sawtooth), 2 (Single), 3 (Triangle).

 |
| **Burst** | `ONPERIODS <value>` | Carrier periods per burst.

 |
|  | `STARTPHASE <value>` | Start/Stop phase (-180 to +180 deg).

 |

### Execution Control

*
`SINGLE`: Starts single burst/sweep.


*
`CONTINUOUS`: Starts continuous burst/sweep.


*
`HOLD`: Stops amplitude (low freq) or sweep.


*
`RELEASE`: Releases HOLD.



### Examples

* **AM:** `FREQ 150E3; SINE; AMPLT 4.5; AM; MODFRE 1.5E3; MODSRC INT; [cite_start]AMDEP 50`.


* **Sweep:** `MODOFF; SWEEP LIN; STOPF 5E6; SWEEPT 5; SWEEPM 3; [cite_start]CONT`.


* **Burst:** `MODOFF; FREQ 15E3; AMPLT 5; BUR; MODFRE 500; ONPER 5; STPHA 45; [cite_start]CONT`.



---

## 6. Arbitrary Waveforms (ARB)

Data consists of 1024 addresses (0-1023) with amplitude values (-511 to +511).

ARB Commands

* `ARBSELECT <1-24>`: Select memory location for storage.
* `ARBITRARY <1-24>`: Activate specific stored waveform.
* `CLEAR ARBIT`: Erase selected waveform.
* `BEGIN <address>`: Define start address (0-1023).
* `CNT <value>`: Address increment (1-255).
* `DATA <y1, y2...>`: Send amplitude data (-511 to +511).
* `FILL <value>`: Set all addresses to one value (DC).

### Python Example: ARB Transfer

```python
# Select memory 2, clear it, start at address 10
device.write('ARBSEL 2; CLEAR ARBIT; BEGIN 10')

# Set increment to 40 and send data points
# Data range -511 to +511 corresponds to 20 Vpp
device.write('CNT 40; DATA 0, 200, -200, 200, -200, 511')

# Activate ARB 2
device.write('ARB 2')

```

---

## 7. Status System

* **Standard Event Status Register (ESR):** Read via `*ESR?`. Bits for Power On (7), User Request (6), Command Error (5), Execution Error (4), Device Error (3), Query Error (2), Operation Complete (0).


* **Status Byte (STB):** Read via `*STB?` or Serial Poll. Bits for RQS/MSS (6), ESB (5), MAV (4).


*
**Error Query:** `ERROR?` returns error number and description (e.g., "ERROR 101/SYNTAX ERROR").
